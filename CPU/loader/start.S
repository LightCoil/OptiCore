/* start.S - Ассемблерный код для начального загрузчика кастомного ядра Xbox 360 */
/* Этот файл отвечает за базовую инициализацию и переход в привилегированный режим */

.global _start
_start:
    /* Настройка стека */
    lis     r1, 0x1fff        /* Установка верхней части адреса стека */
    ori     r1, r1, 0xffff    /* Установка нижней части адреса стека */
    li      r0, 0
    stwu    r0, -8(r1)        /* Инициализация стека */

    /* Сброс регистра LR (Link Register) */
    mtlr    r0

    /* Переход в привилегированный режим через настройку MSR (Machine State Register) */
    mfmsr   r3
    ori     r3, r3, 0x2000    /* Включение режима супервизора */
    mtmsr   r3

    /* Вызов главной функции на C */
    bl      main

    /* Вечный цикл, чтобы не выйти из программы */
1:  b       1b
